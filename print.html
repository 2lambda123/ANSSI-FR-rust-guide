<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Secure Rust Guidelines</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Recommendations for secure applications development with Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="01_introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="02_devenv.html"><strong aria-hidden="true">2.</strong> Development Environment</a></li><li><a href="03_libraries.html"><strong aria-hidden="true">3.</strong> Libraries</a></li><li><a href="04_language.html"><strong aria-hidden="true">4.</strong> The language</a></li><li><a href="05_test_fuzz.html"><strong aria-hidden="true">5.</strong> Test and fuzzing</a></li><li class="affix"><a href="LICENCE.html">Licence</a></li><li class="affix"><a href="checklist.html">Checklist</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Secure Rust Guidelines</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p><a href="https://www.rust-lang.org">Rust</a> is a multi-paradigm language with a focus on
memory safety.</p>
<p>It aims to be systems programming oriented, allowing fine-grained memory
management without garbage collection but also without tedious and error-prone
manual memory allocations and deallocations. It achieves this goal by means of
its ownership system (mostly related to variable aliasing). At any point of a
Rust program, the compiler tracks how many variables refer to a given data, and
enforces a set of rules which enable automatic memory management, memory safety
and data-race free programs.</p>
<p>The language also focuses on performance, with powerful compilation
optimizations and language constructs that allows writing zero-cost abstraction
code.</p>
<p>Moreover, the Rust language provides some high-level programming features.
Thanks to higher-order functions, closures, iterators, etc., it allows writing
program parts in the same vein as in functional programming languages.
Besides, static typing discipline, type inference, and ad hoc polymorphism (in
the form of traits) are other ways Rust provides to build libraries and programs
in a safe manner.</p>
<p>Nevertheless, due to its versatility, the language possibly offers some
constructions that, if not used properly, can introduce security problems,
either by or by making code misinterpreted by the programmer or a reviewer. In
addition, as for every tool in the compilation or software verification field,
the tools used to develop, compile and execute programs can expose certain
features or configurations that, if misused, may lead to vulnerabilities.</p>
<p>Thus, the object of this document is to compile hints and recommendations to
stay in a safe zone for secure applications development while taking advantage
of the range of possibilities Rust language can offer.</p>
<h2><a class="header" href="#target-audience" id="target-audience">Target Audience</a></h2>
<p>The guide intents to group recommendations that should be applied for
application development with strong security level requirements. Anyway, it can
be followed by everyone who wants to ensure that guarantees offered by the Rust
platform are not invalidated due to unsafe, misleading or unclear feature usage.</p>
<p>It is not intended to be a course on how to write Rust programs, there are
already plenty of good learning resources for this purpose
(see for instance the
<a href="https://doc.rust-lang.org">Rust documentation main page</a>).
The purpose is rather to guide the programmer and to inform them about certain
pitfalls. These recommendations form a complement to the good level of trust
the Rust language already provides. That said, recalls are sometimes necessary
for clarity, and the experienced Rust programmer may rely solely on
highlighted inserts (<em>Rule</em>, <em>Recommendation</em>, <em>Warning</em>, etc.).</p>
<h2><a class="header" href="#structure-of-the-document" id="structure-of-the-document">Structure of the Document</a></h2>
<p>The aim with the structure of this document is to consider separately different
phases of a typical (and simplified) development process. Firstly, we provide
some advices for using tools of the Rust ecosystem to how to take advantage
of them for secure development. A second chapter focuses on precautions to
take when choosing and using external libraries. Then, recommendations about
the Rust language constructs are exposed. Finally, we introduce advices for
writing tests for a project in Rust, and for using Rust fuzzing tools.
A summary of recommendations presented throughout the document is listed at the
end of this guide.</p>
<h1><a class="header" href="#development-environment" id="development-environment">Development Environment</a></h1>
<h2><a class="header" href="#rustup" id="rustup">Rustup</a></h2>
<p><a href="https://github.com/rust-lang/rustup.rs">Rustup</a> is the Rust toolchain installer. Among other things, it enables
switching between different flavors of the toolchain (stable, beta, nightly),
managing additional components installation and keeping them up to date.</p>
<blockquote>
<h3><a class="header" href="#warning" id="warning">Warning</a></h3>
<p>From a security perspective, <code>rustup</code> does perform all downloads over HTTPS,
but does not validate signatures of downloads. Protection against downgrade
attacks, certificate pinning, validation of signatures are works that are
currently in progress. In some cases, it may be preferable to opt for
an alternative installation method listed in the <em>Install</em> section of the
official Rust website.</p>
</blockquote>
<h3><a class="header" href="#rust-editions" id="rust-editions">Rust Editions</a></h3>
<p>Several flavors, called <em>editions</em>, of the Rust language coexist.
The concept of editions has been introduced to clarify new features
implementation and to make them incremental. But as stated in the
<a href="https://rust-lang-nursery.github.io/edition-guide/editions/index.html">Edition Guide</a>, this doesn’t mean that new features and improvements will be
shipped on the last edition only.</p>
<p>However, some editions could bring new keywords and language constructs.
Recommendations for secure applications development then remain closely
linked to features that are used in such applications rather than the actual
edition that is declared in it.
In the rest of this guide, best effort will be made to highlight constructions
and language features that are specific to a particular Rust edition.</p>
<blockquote>
<h3><a class="header" href="#note" id="note">Note</a></h3>
<p>No specific edition is recommended, as long as users follow recommendations
that are expressed in relation to features offered by edition that has been
chosen.</p>
</blockquote>
<h3><a class="header" href="#stable-nightly-and-beta-toolchains" id="stable-nightly-and-beta-toolchains">Stable, nightly and beta toolchains</a></h3>
<p>Orthogonally to editions that allows one to select a flavor (a set of features)
of the Rust language, the Rust toolchain is provided in three different
versions, called <em>release channels</em>:</p>
<ul>
<li><em>nightly</em> releases are created once a day,</li>
<li><em>nightly</em> releases are promoted every six weeks to <em>beta</em> releases,</li>
<li><em>beta</em> releases are promoted every six weeks to <em>stable</em> releases.</li>
</ul>
<p>When playing with different toolchains, it is important to check not only what
the default toolchain is, but also if overrides are currently set for some
directories.</p>
<pre><code class="language-shell">$ pwd
/tmp/foo
$ rustup toolchain list
stable-x86_64-unknown-linux-gnu (default)
beta-x86_64-unknown-linux-gnu
nightly-x86_64-unknown-linux-gnu
$ rustup override list
/tmp/foo                                    nightly-x86_64-unknown-linux-gnu
$
</code></pre>
<blockquote>
<h3><a class="header" href="#rule-a-iddenv-stableadenv-stable" id="rule-a-iddenv-stableadenv-stable">Rule <a id="DENV-STABLE"></a>DENV-STABLE</a></h3>
<p>Development of a secure application must be done using a fully stable
toolchain, for limiting potential compiler, runtime or tool bugs.</p>
</blockquote>
<p>When using a specific <code>cargo</code> subcommand that requires a nightly component,
it is preferable to run it by switching the toolchain only locally, instead
of explicitly switching the complete toolchain. For example, to run the
(nightly) latest <code>rustfmt</code>:</p>
<pre><code class="language-shell">$ rustup toolchain list
stable-x86_64-unknown-linux-gnu (default)
beta-x86_64-unknown-linux-gnu
nightly-x86_64-unknown-linux-gnu
$ rustup run nightly cargo fmt
$ # or
$ cargo +nightly fmt
$
</code></pre>
<h2><a class="header" href="#cargo" id="cargo">Cargo</a></h2>
<p>Once Rustup has set up the appropriate Rust toolchain, <a href="https://doc.rust-lang.org/stable/cargo/">Cargo</a> is available
through the command line program <code>cargo</code>. Cargo is the Rust package manager.
It has a fundamental role in most Rust development:</p>
<ul>
<li>It structures project by providing the project skeleton (<code>cargo new</code>),</li>
<li>It compiles the project (<code>cargo build</code>),</li>
<li>It generates the project's documentation (<code>cargo doc</code>),</li>
<li>It runs tests (<code>cargo test</code>) and benchmarks (<code>cargo bench</code>),</li>
<li>It manages and download dependencies,</li>
<li>It makes packages distributable and publishes them on <a href="https://crates.io">crates.io</a>,</li>
<li>It’s also a front-end to run complementary tools such as those that are
described below, in the form of sub-commands.</li>
</ul>
<p><mark>TODO</mark>: identify unsafe features and risky environment variables.</p>
<blockquote>
<h3><a class="header" href="#warning-1" id="warning-1">Warning</a></h3>
<p>Like <code>rustup</code>, <code>cargo</code> does perform all downloads over HTTPS, but does not
validate the registry index. Ongoing discussions occur on how best protect and
verify crates. For now, the security relies on the good security of the
website <a href="https://crates.io">crates.io</a> and the GitHub hosted repository containing the
registry index. In some cases, it may be preferable to opt for an alternative
installation method for dependencies.</p>
</blockquote>
<h3><a class="header" href="#clippy" id="clippy">Clippy</a></h3>
<p><a href="https://github.com/rust-lang/rust-clippy">Clippy</a> is a tool that provides and checks many lints (bugs, styling, performance
issues, etc.). Since the stable toolchain has reached version 1.29, <code>clippy</code> can
be used within the stable <code>rustup</code> environment. It is also recommended
to install <code>clippy</code> as a component (<code>rustup component add clippy</code>) in the
stable toolchain instead of installing it as a project dependency.</p>
<p>The tool comes with some lint categories regarding the kind of issue it aims to
detect. The warnings should be re-checked by the programmer before committing
the fix that is suggested by <code>clippy</code>, especially in the case of lints of the
category <code>clippy::nursery</code> since those hints are still under development.</p>
<blockquote>
<h3><a class="header" href="#rule-a-iddenv-linteradenv-linter" id="rule-a-iddenv-linteradenv-linter">Rule <a id="DENV-LINTER"></a>DENV-LINTER</a></h3>
<p>A linter, such as <code>clippy</code>, must be used regularly during the development of
a secure application.</p>
</blockquote>
<h3><a class="header" href="#rustfmt" id="rustfmt">Rustfmt</a></h3>
<p><a href="https://github.com/rust-lang/rustfmt">Rustfmt</a> is a tool that formats your code according to style guidelines. The
documentation of the tool states some limitations, among others partial macro
declarations and uses support. One should use the <code>--check</code> option that prints
found differences, review these changes, and finally apply them if the code
readability is not affected.</p>
<p>So, to launch it:</p>
<pre><code class="language-shell">$ cargo fmt -- --check
$ # review of the changes
$ cargo fmt
</code></pre>
<p>These guidelines can be customized to your needs by creating a <code>rustfmt.toml</code> or
<code>.rustfmt.toml</code> file at the root of your project. It will be used to override
the default settings, for instance:</p>
<pre><code class="language-toml"># Set the maximum line width to 120
max_width = 120
# Maximum line length for single line if-else expressions
single_line_if_else_max_width = 40
</code></pre>
<p>For more information about the guidelines that <code>rustfmt</code> will check, have a look
at the <a href="https://github.com/rust-dev-tools/fmt-rfcs/blob/master/guide/guide.md">Rust Style Guide</a>.</p>
<blockquote>
<h3><a class="header" href="#rule-a-iddenv-formatadenv-format" id="rule-a-iddenv-formatadenv-format">Rule <a id="DENV-FORMAT"></a>DENV-FORMAT</a></h3>
<p>The tool <code>rustfmt</code> can be used to ensure that the codebase respect style
guidelines (as described in <code>rustfmt.toml</code> file), with <code>--check</code> option and
manual review.</p>
</blockquote>
<h3><a class="header" href="#rustfix" id="rustfix">Rustfix</a></h3>
<p>Included with Rust, since the end of 2018, <a href="https://github.com/rust-lang-nursery/rustfix">Rustfix</a> is a tool dedicated in
fixing compiler warnings as well as easing transitions between editions.</p>
<pre><code class="language-shell">$ cargo fix
</code></pre>
<p>To prepare a Rust 2015 project to transition to Rust 2018, one can run:</p>
<pre><code class="language-shell">$ cargo fix --edition
</code></pre>
<p>Rustfix will either fix the code to be compatible with Rust 2018 or print a
warning that explain the problem. This problem will have to be fixed manually.
By running the command (and possibly fixing manually some issues) until there
is no warning, one can ensure the code is compatible with both Rust 2015 and
Rust 2018.</p>
<p>To switch definitely to Rust 2018, one may run:</p>
<pre><code class="language-shell">$ cargo fix --edition-idioms
</code></pre>
<p>Be advised that this tool provides few guarantees on the soundness of the
proposed fixes. In particular mode, some corrections (such as some of those
provided with the <code>--edition-idioms</code>) are known to break the compilation
or change the program semantics in some case.</p>
<blockquote>
<h3><a class="header" href="#rule-a-iddenv-autofixadenv-autofix" id="rule-a-iddenv-autofixadenv-autofix">Rule <a id="DENV-AUTOFIX"></a>DENV-AUTOFIX</a></h3>
<p>In a secure Rust development, any automatic fix (for instance, provided by
<code>rustfix</code>) must be verified by the developer.</p>
</blockquote>
<h3><a class="header" href="#others" id="others">Others</a></h3>
<p>There exist other useful tools or <code>cargo</code> subcommands for enforcing program
security whether by searching for specific code patterns or by providing
convenient commands for testing or fuzzing. They are discussed in the following
chapters, according to their goals.</p>
<h1><a class="header" href="#libraries" id="libraries">Libraries</a></h1>
<p>In addition to a standard library, Rust provides an easy way to import libraries
in a project, thanks to <code>cargo</code>. The libraries, known as <em>crates</em> in the Rust
ecosystem, are imported from the open-source components central repository
<a href="https://crates.io">crates.io</a>.</p>
<p>It should be noticed that the quality (in terms of security, performances,
readability, etc.) of the published crates is very variable. Moreover, their
maintenance can be irregular or interrupted. The usage of each component from
this repository should be justified, and the developer should validate the
correct application of rules from the current guide in its code. Several tools
can aid in that task.</p>
<h2><a class="header" href="#cargo-outdated" id="cargo-outdated">Cargo-outdated</a></h2>
<p><a href="https://github.com/kbknapp/cargo-outdated">Cargo-outdated</a> tool allows one to easily manage dependencies versions.</p>
<p>For a given crate, it lists current dependencies versions (using its
<code>Cargo.toml</code>), and checks latest compatible version and also latest general
version.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlibs-outdatedalibs-outdated" id="rule-a-idlibs-outdatedalibs-outdated">Rule <a id="LIBS-OUTDATED"></a>LIBS-OUTDATED</a></h3>
<p>The <code>cargo-outdated</code> tool must be used to check dependencies status. Then,
each outdated dependency must be updated or the choice of the version must be
justified.</p>
</blockquote>
<h2><a class="header" href="#cargo-audit" id="cargo-audit">Cargo-audit</a></h2>
<p><a href="https://github.com/RustSec/cargo-audit">Cargo-audit</a> tool allows one to easily check for security vulnerabilities
reported to the RustSec Advisory Database.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlibs-auditalibs-audit" id="rule-a-idlibs-auditalibs-audit">Rule <a id="LIBS-AUDIT"></a>LIBS-AUDIT</a></h3>
<p>The <code>cargo-audit</code> tool must be used to check for known vulnerabilities in
dependencies.</p>
</blockquote>
<h2><a class="header" href="#unsafe-code-in-libraries" id="unsafe-code-in-libraries">Unsafe code in libraries</a></h2>
<p><mark>TODO</mark>: <code>unsafe</code> blocks are discussed in the following chapter.
One needs to ensure that this kind of block is not misused in project
dependencies.</p>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlibs-unsafealibs-unsafe" id="recommendation-a-idlibs-unsafealibs-unsafe">Recommendation <a id="LIBS-UNSAFE"></a>LIBS-UNSAFE</a></h3>
<p><mark>TODO</mark>: check that no <code>unsafe</code> blocks appear in the imported
dependencies (with a tool?).</p>
</blockquote>
<h1><a class="header" href="#the-rust-language" id="the-rust-language">The Rust language</a></h1>
<h2><a class="header" href="#generalities" id="generalities">Generalities</a></h2>
<h3><a class="header" href="#naming" id="naming">Naming</a></h3>
<p>As of now, the standard library is the de facto standard for naming things in
the Rust world. However, an effort has been made to formalize it, first in
<a href="https://github.com/rust-lang/rfcs/blob/master/text/0430-finalizing-naming-conventions.md">RFC 430</a>, then in the <a href="https://rust-lang-nursery.github.io/api-guidelines/">Rust API Guidelines</a>.</p>
<p>The basic rule consists in using :</p>
<ul>
<li><code>UpperCamelCase</code> for types, traits, enum variants,</li>
<li><code>snake_case</code> for functions, methods, macros, variables and modules,</li>
<li><code>SCREAMING_SNAKE_CASE</code> for statics and constants,</li>
<li><code>'lowercase</code> for lifetimes.</li>
</ul>
<p>The <a href="https://rust-lang-nursery.github.io/api-guidelines/">Rust API Guidelines</a> also prescribes more precise naming conventions for
some particular constructions:</p>
<ul>
<li>(C-CONV) for conversion methods (<code>as_</code>, <code>to_</code>, <code>into_</code>),</li>
<li>(C-GETTER) for getters,</li>
<li>(C-ITER) for iterator-producing methods,</li>
<li>(C-ITER-TY) for iterator types,</li>
<li>(C-FEATURE) for feature naming,</li>
<li>(C-WORD-ORDER) for word order consistency.</li>
</ul>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-namingalang-naming" id="rule-a-idlang-namingalang-naming">Rule <a id="LANG-NAMING"></a>LANG-NAMING</a></h3>
<p>Development of a secure application must follow the naming conventions
outlined in the <a href="https://rust-lang-nursery.github.io/api-guidelines/">Rust API Guidelines</a>.</p>
</blockquote>
<h3><a class="header" href="#memory-management" id="memory-management">Memory management</a></h3>
<p><mark>TODO</mark>: explain safe allocations/deallocations, ownership/borrowing,
and identify language constructs that may break memory safety (for instance,
unsound behaviors in older versions of the compiler).</p>
<h4><a class="header" href="#uninitialized-memory" id="uninitialized-memory">Uninitialized memory</a></h4>
<p>By default, Rust forces all values to be initialized, preventing the use of
uninitialized memory (except if using <code>std::mem::uninitialized</code> or
<code>std::mem::MaybeUninit</code>).</p>
<blockquote>
<h3><a class="header" href="#rule-a-idmem-uninitamem-uninit" id="rule-a-idmem-uninitamem-uninit">Rule <a id="MEM-UNINIT"></a>MEM-UNINIT</a></h3>
<p>The <code>std::mem::uninitialized</code> function (deprecated 1.38) or the
<code>std::mem::MaybeUninit</code> type (stabilized 1.36) must not be used, or explicitly
justified when necessary.</p>
</blockquote>
<p>The use of uninitialized memory may result in two distinct security issues:</p>
<ul>
<li>drop of uninitialized memory (also a memory safety issue),</li>
<li>non-drop of initialized memory.</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<p><code>std::mem::MaybeUninit</code> is an improvement over <code>std::mem::uninitialized</code>.
Indeed, it makes dropping uninitialized values a lot more difficult.
However, it does not change the second issue: the non-drop of an initialized
memory is as much likely. It is problematic, in particular when considering
the use of <code>Drop</code> to erase sensitive memory.</p>
</blockquote>
<h4><a class="header" href="#secure-memory-zeroing-for-sensitive-information" id="secure-memory-zeroing-for-sensitive-information">Secure memory zeroing for sensitive information</a></h4>
<p>Zeroing memory is useful for sensitive variables, especially if the
Rust code is used through FFI.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idmem-zeroamem-zero" id="rule-a-idmem-zeroamem-zero">Rule <a id="MEM-ZERO"></a>MEM-ZERO</a></h3>
<p>Variables containing sensitive data must be zeroed out after use, using
functions that will not be removed by the compiler optimizations, like
<code>std::ptr::write_volatile</code> or the <code>zeroize</code> crate.</p>
</blockquote>
<p>The following code shows how to define an integer type that will be set to
0 when freed, using the <code>Drop</code> trait:</p>
<pre><pre class="playpen"><code class="language-rust">/// Example: u32 newtype, set to 0 when freed
pub struct ZU32(pub u32);

impl Drop for ZU32 {
    fn drop(&amp;mut self) {
        println!(&quot;zeroing memory&quot;);
        unsafe{ ::std::ptr::write_volatile(&amp;mut self.0, 0) };
    }
}

# fn main() {
{
    let i = ZU32(42);
    // ...
} // i is freed here
# }
</code></pre></pre>
<h3><a class="header" href="#unsafe-code" id="unsafe-code">Unsafe code</a></h3>
<p>The joint utilization of the type system and the ownership system aims to
enforce safety regarding the memory management in Rust's programs. So the
language aims to avoid memory overflows, null or invalid pointer constructions,
and data races.
To perform risky actions such as system calls, type coercions, or memory
pointers direct manipulations, the language provides the <code>unsafe</code> keyword.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-unsafealang-unsafe" id="rule-a-idlang-unsafealang-unsafe">Rule <a id="LANG-UNSAFE"></a>LANG-UNSAFE</a></h3>
<p>For a secured development, the <code>unsafe</code> blocks must be avoided. Afterward,
we list the only cases where <code>unsafe</code> may be used, provided that they come
with a proper justification:</p>
<ul>
<li>
<p>The Foreign Function Interface (FFI) of Rust allows for describing
functions whose implementation is written in C, using the <code>extern &quot;C&quot;</code>
prefix. To use such a function, the <code>unsafe</code> keyword is required. “Safe”
wrapper shall be defined to safely and seamlessly call C code.</p>
</li>
<li>
<p>For embedded device programming, registers and various other resources are
often accessed through a fixed memory address. In this case, <code>unsafe</code> blocks
are required to initialize and dereference those particular pointers in Rust.
In order to minimize the number of unsafe accesses in the code and to allow
easier identification of them by a programmer, a proper abstraction (data
structure or module) shall be provided.</p>
</li>
<li>
<p>A function can be marked unsafe globally (by prefixing its declaration with
the <code>unsafe</code> keyword) when it may exhibit unsafe behaviors based on its
arguments, that are unavoidable. For instance, this happens when a function
tries to dereference a pointer passed as an argument.</p>
</li>
</ul>
<p>With the exception of these cases, <code>#[forbid(unsafe_code)]</code> must appear in
<code>main.rs</code> to generate compilation errors if <code>unsafe</code> is used in the code base.</p>
</blockquote>
<h3><a class="header" href="#integer-overflows" id="integer-overflows">Integer overflows</a></h3>
<p>Although some verification is performed by Rust regarding the potential
integer overflows, precautions should be taken when executing arithmetic
operations on integers.</p>
<p>In particular, it should be noted that using debug or release compilation
profile changes integer overflow behavior. In debug configuration, overflow
cause the termination of the program (<code>panic</code>), whereas in the release
configuration the computed value silently wraps around the maximum value that
can be stored.</p>
<p>This last behavior can be made explicit by using the <code>Wrapping</code> generic type,
or the <code>overflowing_&lt;op&gt;</code> and <code>wrapping_&lt;op&gt;</code> operations on integers
(the <code>&lt;op&gt;</code> part being <code>add</code>, <code>mul</code>, <code>sub</code>, <code>shr</code>, etc.).</p>
<pre><pre class="playpen"><code class="language-rust">use std::num::Wrapping;
# use std::panic;

# fn main() {
let x: u8 = 242;

# let result = panic::catch_unwind(|| {
println!(&quot;{}&quot;, x + 50);                      // panics in debug, prints 36 in release.
# });
# if result.is_err() { println!(&quot;panic&quot;); }
println!(&quot;{}&quot;, x.overflowing_add(50).0);     // always prints 36.
println!(&quot;{}&quot;, x.wrapping_add(50));          // always prints 36.
println!(&quot;{}&quot;, Wrapping(x) + Wrapping(50));  // always prints 36.

// always panics:
let (res, c) = x.overflowing_add(50);
# let result = panic::catch_unwind(|| {
if c { panic!(&quot;custom error&quot;); }
else { println!(&quot;{}&quot;, res); }
# });
# if result.is_err() { println!(&quot;panic&quot;); }
# }
</code></pre></pre>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-arithalang-arith" id="rule-a-idlang-arithalang-arith">Rule <a id="LANG-ARITH"></a>LANG-ARITH</a></h3>
<p>When assuming that an arithmetic operation can produce an overflow, the
specialized functions <code>overflowing_&lt;op&gt;</code>, <code>wrapping_&lt;op&gt;</code>, or the
<code>Wrapping</code> type must be used.</p>
</blockquote>
<h2><a class="header" href="#type-system" id="type-system">Type system</a></h2>
<p><mark>TODO</mark>: identify pitfalls with the type system (for instance,
misunderstanding of which code is actually executed when implementing complex
patterns with traits).</p>
<h2><a class="header" href="#error-handling" id="error-handling">Error handling</a></h2>
<p><mark>TODO</mark>: explicit good practices in error handling.</p>
<p>The <code>Result</code> type is the preferred way of handling functions that can fail.
A <code>Result</code> object must be tested, and never ignored.</p>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-errwrapalang-errwrap" id="recommendation-a-idlang-errwrapalang-errwrap">Recommendation <a id="LANG-ERRWRAP"></a>LANG-ERRWRAP</a></h3>
<p>A crate can implement its own Error type, wrapping all possible errors.
It must be careful to make this type exception-safe (RFC 1236), and implement
<code>Error + Send + Sync + 'static</code> as well as <code>Display</code>.</p>
</blockquote>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-errdoalang-errdo" id="recommendation-a-idlang-errdoalang-errdo">Recommendation <a id="LANG-ERRDO"></a>LANG-ERRDO</a></h3>
<p>The <code>?</code> operator should be used to improve readability of code.
The <code>try!</code> macro should not be used.</p>
</blockquote>
<p>The <a href="https://crates.io/crates/error-chain">error-chain</a> and <a href="https://crates.io/crates/failure">failure</a> crates can be used to wrap errors.</p>
<h3><a class="header" href="#panics" id="panics">Panics</a></h3>
<p>Explicit error handling (<code>Result</code>) should always be preferred instead of calling
<code>panic</code>.  The cause of the error should be available, and generic errors should
be avoided.</p>
<p>Crates providing libraries should never use functions or instructions that can
fail and cause the code to panic.</p>
<p>Common patterns that can cause panics are:</p>
<ul>
<li>using <code>unwrap</code> or <code>expect</code>,</li>
<li>using <code>assert</code>,</li>
<li>an unchecked access to an array,</li>
<li>integer overflow (in debug mode),</li>
<li>division by zero,</li>
<li>large allocations,</li>
<li>string formatting using <code>format!</code>.</li>
</ul>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-nopanicalang-nopanic" id="rule-a-idlang-nopanicalang-nopanic">Rule <a id="LANG-NOPANIC"></a>LANG-NOPANIC</a></h3>
<p>Functions or instructions that can cause the code to panic at runtime must not
be used.</p>
</blockquote>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-arrindexingalang-arrindexing" id="rule-a-idlang-arrindexingalang-arrindexing">Rule <a id="LANG-ARRINDEXING"></a>LANG-ARRINDEXING</a></h3>
<p>Array indexing must be properly tested, or the <code>get</code> method should be used to
return an <code>Option</code>.</p>
</blockquote>
<p><mark>TODO</mark> Check if the <a href="https://github.com/dtolnay/no-panic">no_panic</a>
crate can catch all cases. Drawback: all functions need to be marked as
<code>#[no_panic]</code>.</p>
<!--
<mark>TODO</mark> Another possibility:
[rustig](https://github.com/Technolution/rustig) (doesn't build here)
-->
<h3><a class="header" href="#ffi-and-panics" id="ffi-and-panics">FFI and panics</a></h3>
<p>When calling Rust code from another language (for ex. C), the Rust code must
be careful to never panic.
Unwinding from Rust code into foreign code results in undefined behavior.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-ffipanicalang-ffipanic" id="rule-a-idlang-ffipanicalang-ffipanic">Rule <a id="LANG-FFIPANIC"></a>LANG-FFIPANIC</a></h3>
<p>Rust code called from FFI must either ensure the function cannot panic, or use
<code>catch_unwind</code> or the <code>std::panic</code> module to ensure the rust code will not
abort or return in an unstable state.</p>
</blockquote>
<p>Note that <code>catch_unwind</code> will only catch unwinding panics, not those that abort
the process.</p>
<h2><a class="header" href="#standard-library-traits" id="standard-library-traits">Standard library traits</a></h2>
<h3><a class="header" href="#drop-trait-the-destructor" id="drop-trait-the-destructor"><code>Drop</code> trait, the destructor</a></h3>
<p>Types implement the trait <code>std::ops::Drop</code> to perform some operations when the
memory associated with a value of this type is to be reclaimed. <code>Drop</code> is the
Rust equivalent of a destructor in C++ or a finalizer in Java.</p>
<p>Dropping is done recursively from the outer value to the inner values.
When a value goes out of scope (or is explicitly dropped with <code>std::mem::drop</code>),
the value is dropped in two steps. The first step happens only if the type of
this value implements <code>Drop</code>. It consists in calling the <code>drop</code> method on it.
The second step consists in repeating the dropping process recursively on any
field the value contains. Note that a <code>Drop</code> implementation is
<strong>only responsible for the outer value</strong>.</p>
<p>First and foremost, implementing <code>Drop</code> should not be systematic.
It is only needed if the type requires some destructor logic. In fact, <code>Drop</code> is
typically used to release external resources (network connections, files, etc.)
or to release memory (e.g. in smart pointers such as <code>Box</code> or <code>Rc</code>).
As a result, <code>Drop</code> trait implementations are likely to contain <code>unsafe</code> code
blocks as well as other security-critical operations.</p>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-dropalang-drop" id="recommendation-a-idlang-dropalang-drop">Recommendation <a id="LANG-DROP"></a>LANG-DROP</a></h3>
<p>In a Rust secure development, the implementation of the <code>std::ops::Drop</code> trait
should be justified, documented and peer-reviewed.</p>
</blockquote>
<p>Second, Rust type system only ensures memory safety and, from the type system's
standpoint, missing drops is allowed. In fact, several things may lead to
missing drops, such as:</p>
<ul>
<li>a reference cycle (for instance, with <code>Rc</code> or <code>Arc</code>),</li>
<li>an explicit call to <code>std::mem::forget</code> (or <code>core::mem::forget</code>) (see Rule
<mark>TODO</mark>),</li>
<li>a panic in drop,</li>
<li>program aborts (and panics when abort-on-panic is on).</li>
</ul>
<p>And missing drops may lead to exposing sensitive data or to lock limited
resources leading to unavailability issues.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-drop-no-panicalang-drop-no-panic" id="rule-a-idlang-drop-no-panicalang-drop-no-panic">Rule <a id="LANG-DROP-NO-PANIC"></a>LANG-DROP-NO-PANIC</a></h3>
<p>In a Rust secure development, the implementation of the <code>std::ops::Drop</code> trait
must not panic.</p>
</blockquote>
<p>Beside panics, secure-critical drop should be protected.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-drop-no-cyclealang-drop-no-cycle" id="rule-a-idlang-drop-no-cyclealang-drop-no-cycle">Rule <a id="LANG-DROP-NO-CYCLE"></a>LANG-DROP-NO-CYCLE</a></h3>
<p>Value whose type implements <code>Drop</code> must not be embedded directly or indirectly
in a cycle of reference-counted references.</p>
</blockquote>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-drop-secalang-drop-sec" id="recommendation-a-idlang-drop-secalang-drop-sec">Recommendation <a id="LANG-DROP-SEC"></a>LANG-DROP-SEC</a></h3>
<p>Ensuring security operations at the end of some treatment (such as key erasure
at the end of a cryptographic encryption) should not rely only on the <code>Drop</code>
trait implementation.</p>
</blockquote>
<h3><a class="header" href="#send-and-sync-traits" id="send-and-sync-traits"><code>Send</code> and <code>Sync</code> traits</a></h3>
<p>The <code>Send</code> and <code>Sync</code> traits (defined in <code>std::marker</code> or <code>core::marker</code>) are
marker traits used to ensure the safety of concurrency in Rust. When implemented
correctly, they allow the Rust compiler to guarantee the absence of data races.
Their semantics is as follows:</p>
<ul>
<li>A type is <code>Send</code> if it is safe to send (move) it to another thread.</li>
<li>A type is <code>Sync</code> if it is safe to share a immutable reference to it with
another thread.</li>
</ul>
<p>Both traits are <em>unsafe traits</em>, i.e., the Rust compiler does not verify in any
way that they are implemented correctly. The danger is real: an incorrect
implementation may lead to <strong>undefined behavior</strong>.</p>
<p>Fortunately, in most cases, one does not need to implement it. In Rust,
almost all primitive types are <code>Send</code> and <code>Sync</code>, and for most compound types
the implementation is automatically provided by the Rust compiler.
Notable exceptions are:</p>
<ul>
<li>Raw pointers are neither <code>Send</code> nor <code>Sync</code> because they offer no safety
guards.</li>
<li><code>UnsafeCell</code> is not <code>Sync</code> (and as a result <code>Cell</code> and <code>RefCell</code> aren't
either) because they offer interior mutability (mutably shared value).</li>
<li><code>Rc</code> is neither <code>Send</code> nor <code>Sync</code> because the reference counter is shared and
unsynchronized.</li>
</ul>
<p>Automatic implementation of <code>Send</code> (resp. <code>Sync</code>) occurs for a compound type
(structure or enumeration) when all fields have <code>Send</code> types (resp. <code>Sync</code>
types). Using an unstable feature (as of Rust 1.37.0), one can block the
automatic implementation of those traits with a manual
<em>negative implementation</em>:</p>
<pre><code class="language-rust ignore noplaypen">#![feature(option_builtin_traits)]

struct SpecialType(u8);
impl !Send for SpecialType {}
impl !Sync for SpecialType {}
</code></pre>
<p>The negative implementation of <code>Send</code> or <code>Sync</code> are also used in the standard
library for the exceptions, and are automatically implemented when appropriate.
As a result, the generated documentation is always explicit: a type implements
either <code>Send</code> or <code>!Send</code> (resp. <code>Sync</code> or <code>!Sync</code>).</p>
<p>As a stable alternative to negative implementation, one can use a <code>PhantomData</code>
field:</p>
<pre><pre class="playpen"><code class="language-rust noplayplen">
# #![allow(unused_variables)]
#fn main() {
# use std::marker::PhantomData;
#
struct SpecialType(u8, PhantomData&lt;*const ()&gt;);
#}</code></pre></pre>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-sync-traitsalang-sync-traits" id="recommendation-a-idlang-sync-traitsalang-sync-traits">Recommendation <a id="LANG-SYNC-TRAITS"></a>LANG-SYNC-TRAITS</a></h3>
<p>In a Rust secure development, the manual implementation of the <code>Send</code> and
<code>Sync</code> traits should be avoided and, if necessary, should be justified,
documented and peer-reviewed.</p>
</blockquote>
<h3><a class="header" href="#comparison-traits-partialeq-eq-partialord-ord" id="comparison-traits-partialeq-eq-partialord-ord">Comparison traits (<code>PartialEq</code>, <code>Eq</code>, <code>PartialOrd</code>, <code>Ord</code>)</a></h3>
<p>Comparisons (<code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>) in Rust relies on four standard
traits available in <code>std::cmp</code> (or <code>core::cmp</code> for <code>no_std</code> compilation):</p>
<ul>
<li><code>PartialEq&lt;Rhs&gt;</code> that defines a partial equivalence between
objects of types <code>Self</code> and <code>Rhs</code>,</li>
<li><code>PartialOrd&lt;Rhs&gt;</code> that defines a partial order between objects of types
<code>Self</code> and <code>Rhs</code>,</li>
<li><code>Eq</code> that defines a total equivalence between objects of the same
type. It is only a marker trait that requires <code>PartialEq&lt;Self&gt;</code>!</li>
<li><code>Ord</code> that defines the total order between objects of the same type.
It requires that <code>PartialOrd&lt;Self&gt;</code> is implemented.</li>
</ul>
<p>As documented in the standard library, Rust assumes <strong>a lot of invariants</strong>
about the implementations of those traits:</p>
<ul>
<li>
<p>For <code>PartialEq</code></p>
<ul>
<li>
<p><em>Internal consistency</em>: <code>a.ne(b)</code> is equivalent to <code>!a.eq(b)</code>, i.e., <code>ne</code> is
the strict inverse of <code>eq</code>. The default implementation of <code>ne</code> is precisely
that.</p>
</li>
<li>
<p><em>Symmetry</em>: <code>a.eq(b)</code> and <code>b.eq(a)</code>, are equivalent. From the developer's
point of view, it means:</p>
<ul>
<li><code>PartialEq&lt;B&gt;</code> is implemented for type <code>A</code> (noted <code>A: PartialEq&lt;B&gt;</code>),</li>
<li><code>PartialEq&lt;A&gt;</code> is implemented for type <code>B</code> (noted <code>B: PartialEq&lt;A&gt;</code>),</li>
<li>both implementations are consistent with each other.</li>
</ul>
</li>
<li>
<p><em>Transitivity</em>: <code>a.eq(b)</code> and <code>b.eq(c)</code> implies <code>a.eq(c)</code>. It means that:</p>
<ul>
<li><code>A: PartialEq&lt;B&gt;</code>,</li>
<li><code>B: PartialEq&lt;C&gt;</code>,</li>
<li><code>A: PartialEq&lt;C&gt;</code>,</li>
<li>the three implementations are consistent with each other (and their
symmetric implementations).</li>
</ul>
</li>
</ul>
</li>
<li>
<p>For <code>Eq</code></p>
<ul>
<li>
<p><code>PartialEq&lt;Self&gt;</code> is implemented.</p>
</li>
<li>
<p><em>Reflexivity</em>: <code>a.eq(a)</code>. This stands for <code>PartialEq&lt;Self&gt;</code> (<code>Eq</code> does not
provide any method).</p>
</li>
</ul>
</li>
<li>
<p>For <code>PartialOrd</code></p>
<ul>
<li>
<p><em>Equality consistency</em>:
<code>a.eq(b)</code> is equivalent to <code>a.partial_cmp(b) == Some(std::ordering::Eq)</code>.</p>
</li>
<li>
<p><em>Internal consistency</em>:</p>
<ul>
<li><code>a.lt(b)</code> iff <code>a.partial_cmp(b) == Some(std::ordering::Less)</code>,</li>
<li><code>a.gt(b)</code> iff <code>a.partial_cmp(b) == Some(std::ordering::Greater)</code>,</li>
<li><code>a.le(b)</code> iff <code>a.lt(b) || a.eq(b)</code>,</li>
<li><code>a.ge(b)</code> iff <code>a.gt(b) || a.eq(b)</code>.</li>
</ul>
<p>Note that by only defining <code>partial_cmp</code>, the internal consistency is
guaranteed by the default implementation of <code>lt</code>, <code>le</code>, <code>gt</code>, and <code>ge</code>.</p>
</li>
<li>
<p><em>Antisymmetry</em>: <code>a.lt(b)</code> (respectively <code>a.gt(b)</code>) implies <code>b.gt(a)</code>
(respectively, <code>b.lt(b)</code>). From the developer's standpoint, it also means:</p>
<ul>
<li><code>A: PartialOrd&lt;B&gt;</code>,</li>
<li><code>B: PartialOrd&lt;A&gt;</code>,</li>
<li>both implementations are consistent with each other.</li>
</ul>
</li>
<li>
<p><em>Transitivity</em>: <code>a.lt(b)</code> and <code>b.lt(c)</code> implies <code>a.lt(c)</code> (also with <code>gt</code>,
<code>le</code> and <code>ge</code>). It also means:</p>
<ul>
<li><code>A: PartialOrd&lt;B&gt;</code>,</li>
<li><code>B: PartialOrd&lt;C&gt;</code>,</li>
<li><code>A: PartialOrd&lt;C&gt;</code>,</li>
<li>the implementations are consistent with each other (and their symmetric).</li>
</ul>
</li>
</ul>
</li>
<li>
<p>For <code>Ord</code></p>
<ul>
<li>
<p><code>PartialOrd&lt;Self&gt;</code></p>
</li>
<li>
<p><em>Totality</em>: <code>a.partial_cmp(b) != None</code> always. In other words,
exactly one of <code>a.eq(b)</code>, <code>a.lt(b)</code>, <code>a.gt(b)</code> is true.</p>
</li>
<li>
<p><em>Consistency with <code>PartialOrd&lt;Self&gt;</code></em>: <code>Some(a.cmp(b)) == a.partial_cmp(b)</code>.</p>
</li>
</ul>
</li>
</ul>
<p>The compiler do not check any of those requirements except for the type checking
itself. However, comparisons are critical because they intervene both in
liveness critical systems such as schedulers and load balancers, and in
optimized algorithms that may use <code>unsafe</code> blocks.
In the first use, a bad ordering may lead to availability issues such as
deadlocks.
In the second use, it may lead to classical security issues linked to memory
safety violations. That is again a factor in the practice of limiting the use
of <code>unsafe</code> blocks.</p>
<blockquote>
<h3><a class="header" href="#rule-a-idlang-cmp-invalang-cmp-inv" id="rule-a-idlang-cmp-invalang-cmp-inv">Rule <a id="LANG-CMP-INV"></a>LANG-CMP-INV</a></h3>
<p>In a Rust secure development, the implementation of standard comparison traits
must respect the invariants described in the documentation.</p>
</blockquote>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-cmp-defaultsalang-cmp-defaults" id="recommendation-a-idlang-cmp-defaultsalang-cmp-defaults">Recommendation <a id="LANG-CMP-DEFAULTS"></a>LANG-CMP-DEFAULTS</a></h3>
<p>In a Rust secure development, the implementation of standard comparison traits
should only define methods with no default implementation, so as to reduce
the risk of violating the invariants associated with the traits.</p>
</blockquote>
<p>There is a Clippy lint to check that <code>PartialEq::ne</code> is not defined in
<code>PartialEq</code> implementations.</p>
<p>Rust comes with a standard way to automatically construct implementations of the
comparison traits through the <code>#[derive(...)]</code> attribute:</p>
<ul>
<li>Derivation <code>PartialEq</code> implements <code>PartialEq&lt;Self&gt;</code> with a
<strong>structural equality</strong> providing that each subtype is <code>PartialEq&lt;Self&gt;</code>.</li>
<li>Derivation <code>Eq</code> implements the <code>Eq</code> marker trait providing that each subtype
is <code>Eq</code>.</li>
<li>Derivation <code>PartialOrd</code> implements <code>PartialOrd&lt;Self&gt;</code> as a
<strong>lexicographical order</strong> providing that each subtype is <code>PartialOrd</code>.</li>
<li>Derivation <code>Ord</code> implements <code>Ord</code> as a <strong>lexicographical order</strong>
providing that each subtype is <code>Ord</code>.</li>
</ul>
<p>For instance, the short following code shows how to compare two <code>T1</code>s easily.
All the assertions hold.</p>
<pre><pre class="playpen"><code class="language-rust">#[derive(PartialEq, Eq, PartialOrd, Ord)]
struct T1 {
    a: u8, b: u8
}

# fn main() {
assert!(&amp;T1 { a: 0, b: 0 } == Box::new(T1 { a: 0, b: 0 }).as_ref());
assert!(T1 { a: 1, b: 0 } &gt; T1 { a: 0, b: 0 });
assert!(T1 { a: 1, b: 1 } &gt; T1 { a: 1, b: 0 });
# println!(&quot;all tests passed.&quot;);
# }
</code></pre></pre>
<blockquote>
<p><strong>Warning</strong></p>
<p>Derivation of comparison traits for compound types depends on the
<strong>field order</strong> not on their name.</p>
<p>First, it means changing the order of two fields change the order. For
instance, provided this second ordered type:</p>
<pre><code class="language-rust noplaypen">#[derive(PartialEq, Eq, PartialOrd, Ord)]
struct T2{
   b: u8, a: u8
};
</code></pre>
<p>we have <code>T1 {a: 1, b: 0} &gt; T1 {a: 0, b: 1}</code> but
<code>T2 {a: 1, b: 0} &lt; T2 {a: 0, b: 1}</code>.</p>
<p>Second, if one of the underlying comparison panics, the order may change the
result due to the use of short-circuit logic in the automatic implementation.</p>
<p>For enums, the derived comparisons depends first on the <strong>variant order</strong> then
on the field order.</p>
</blockquote>
<p>Despite the ordering caveat, derived comparisons are a lot less error-prone
than manual ones and makes code more shorter and easier to maintain:</p>
<blockquote>
<h3><a class="header" href="#recommendation-a-idlang-cmp-derivealang-cmp-derive" id="recommendation-a-idlang-cmp-derivealang-cmp-derive">Recommendation <a id="LANG-CMP-DERIVE"></a>LANG-CMP-DERIVE</a></h3>
<p>In a secure Rust development, the implementation of standard comparison traits
should be automatically derived with <code>#[derive(...)]</code> when structural equality
and lexicographical comparison is needed. Any manual implementation of
standard comparison traits should be documented and justified.</p>
</blockquote>
<h2><a class="header" href="#macros" id="macros">Macros</a></h2>
<p><mark>TODO</mark>: cyclomatic complexity of the macro expanded code, recursion
limits, ...</p>
<h1><a class="header" href="#tests-and-fuzzing" id="tests-and-fuzzing">Tests and fuzzing</a></h1>
<h2><a class="header" href="#writing-tests" id="writing-tests">Writing tests</a></h2>
<p><mark>TODO</mark>: good practices in writing tests.</p>
<h2><a class="header" href="#fuzzing" id="fuzzing">Fuzzing</a></h2>
<h3><a class="header" href="#cargo-fuzz" id="cargo-fuzz">cargo-fuzz</a></h3>
<p><mark>TODO</mark>: good practices in fuzzing programs or part of programs.</p>
<h1><a class="header" href="#open-licence-20licence-ouverte-20" id="open-licence-20licence-ouverte-20">OPEN LICENCE 2.0/LICENCE OUVERTE 2.0</a></h1>
<h2><a class="header" href="#reuse-of-the-information-covered-by-this-licence" id="reuse-of-the-information-covered-by-this-licence">“Reuse” of the “Information” covered by this licence</a></h2>
<p>The “Grantor” grants the “Reuser” the free, non-exclusive right to “Reuse” the “Information” subject of this licence, for commercial or non-commercial purposes, worldwide and for an unlimited period, in accordance with the conditions stated below.</p>
<p><strong>The “Reuser” is free to reuse the “Information”:</strong></p>
<ul>
<li>To reproduce it, copy it.</li>
<li>To adapt, modify, retrieve and transform it in order to create “derived information”, products and services.</li>
<li>To share, disseminate, redistribute, publish and transmit it.</li>
<li>To exploit it for commercial purposes, e.g., by combining it with other information, or by including it in his/her own product or application.</li>
</ul>
<p><strong>Subject to:</strong></p>
<ul>
<li>An acknowledgement of the authorship of the “Information”: its source (at least, the name of the “Grantor”) and the date of the most recent update of the reused “Information”. Specifically, the “Reuser” may satisfy this condition by pointing, via a hypertext link, to the source of “the Information” and so supplying an actual acknowledgement of its authorship.</li>
</ul>
<p><strong>For example:</strong></p>
<blockquote>
<p>“Ministry of xxx—Original data downloaded from <code>http://www.data.gouv.fr/fr/datasets/xxx/</code>, updated on 14 February 2017”.</p>
</blockquote>
<p>This acknowledgement of authorship does not confer any official status on the “Reuse” of the “Information”, and must not suggest any sort of recognition or endorsement on the part of the “Grantor”, or any other public entity, of the “Reuser” or of their “Reuse”.</p>
<h2><a class="header" href="#personal-data" id="personal-data">Personal data</a></h2>
<p>The “Information” made available may contain “Personal data” that may be subject to “Reuse”. If this is the case, the “Grantor” informs the “Reuser” about its existence. The “Information” may be freely reused, within the rights granted by this licence, subject to compliance with the legal framework relating to personal data protection.</p>
<h2><a class="header" href="#intellectual-property-rights" id="intellectual-property-rights">Intellectual property rights</a></h2>
<p>It is guaranteed to The “Reuser” that potential “Intellectual property rights” held by third parties or by the “Grantor” on “Information” do not interfere with the rights granted by this licence.</p>
<p>When the “Grantor” holds transferable “Intellectual property rights” on the “Information”, he/she assigns these to the “Reuser” on a non-exclusive basis, free of charge, worldwide, for the entire duration of the “Intellectual property rights”, and the “Reuser” is free to use the “Information” for any purpose that complies with the rights and conditions defined in this licence.</p>
<h2><a class="header" href="#liability" id="liability">Liability</a></h2>
<p>The “Information” is made available as it is produced or received by the “Grantor”, without any other express or tacit guarantee than those set out in this licence. The “Grantor” does not guarantee the absence of errors or inaccuracies in the “Information”, nor a continuous supply of the “Information”. He/she cannot be held responsible for any loss, prejudice or damage of any kind caused to third parties as a result of the “Reuse”.</p>
<p>The “Reuser” is solely responsible for the “Reuse” of the “Information”. This “Reuse” must not mislead third parties as to the contents of the “Information”, its source or its date of update.</p>
<h2><a class="header" href="#applicable-legislation" id="applicable-legislation">Applicable legislation</a></h2>
<p>This licence is governed by French law.</p>
<h3><a class="header" href="#compatibility-of-this-licence" id="compatibility-of-this-licence">Compatibility of this licence</a></h3>
<p>This licence has been designed to be compatible with any free licence that at least requires an acknowledgement of authorship, and specifically with the previous version of this licence as well as with the following licences: United Kingdom’s “Open Government Licence” (OGL), Creative Commons’ “Creative Commons Attribution” (CC-BY) and Open Knowledge Foundation’s “Open Data Commons Attribution” (ODC-BY).</p>
<h2><a class="header" href="#definitions" id="definitions">Definitions</a></h2>
<p>Within the meaning of this licence, are to be considered as :</p>
<ul>
<li>The “Grantor”: any person granting the right to “Reuse” “Information” under the rights and conditions set out in this licence.</li>
<li>The “Information”:
<ul>
<li>any public information contained in documents disclosed or published by any administration referred to in the first paragraph of Article L. 300-2 of the code des relations entre le public et l’administration (CRPA),</li>
<li>any information made available by any person under the terms and conditions of this licence.</li>
</ul>
</li>
<li>The “Reuse”: the use of the “Information” for other purposes than those for which it was produced or received.</li>
<li>The“Reuser”: any person reusing the “Information” in accordance with the conditions of this licence.</li>
<li>“Personal data”: any information relating to an identified or identifiable natural person who may be identified directly or indirectly. Its “Reuse” is conditional on the respect of the existing legal framework.</li>
<li>“Derived information”: any new data or information created directly from the “Information” or from a combination of the “Information” and other data or information not subject to this licence.</li>
<li>“Intellectual property rights”: all rights identified as such under the code de la propriété intellectuelle (including copyright, rights related to copyright, sui generis rights of database producers, etc.).</li>
</ul>
<h2><a class="header" href="#about-this-licence" id="about-this-licence">About this licence</a></h2>
<p>This licence is intended to be used by administrations for the reuse of their public information. It can also be used by any individual wishing to supply “Information” under the conditions defined in this licence.</p>
<p>France has a comprehensive legal framework aiming at the spontaneous dissemination by the administrations of their public information in order to ensure the widest possible reuse of this information.</p>
<p>The right to “Reuse” the administrations’ “Information” is governed by the code des relations entre le public et l’administration  (CRPA).</p>
<p>This licence facilitates the unrestricted and free of charge reuse of public information and is one of the licences which can be used by the administration pursuant to the decree issued under article L. 323-2 of the CRPA.</p>
<p>Under the Prime Minister’s authority, the Etalab mission is mandated to open up the maximum amount of data held by State administrations and public institutions. Etalab has drawn up the Open Licence to facilitate the unrestricted and free of charge reuse of public information, as defined by article L. 321-1 of the CRPA.</p>
<p>This licence is version 2.0 of the Open Licence.</p>
<p>Etalab reserves the right to propose new versions of the Open Licence. Nevertheless, “Reusers” may continue to reuse information obtained under this licence should they so wish.</p>
<h1><a class="header" href="#checklist" id="checklist">Checklist</a></h1>
<ul>
<li>
<p>Development Environment:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Use a stable compilation toolchain (<a href="02_devenv.html#DENV-STABLE">DENV-STABLE</a>)</li>
<li><input disabled="" type="checkbox"/>
Use linter regularly (<a href="02_devenv.html#DENV-LINTER">DENV-LINTER</a>)</li>
<li><input disabled="" type="checkbox"/>
Use Rust formatter (rustfmt) (<a href="02_devenv.html#DENV-FORMAT">DENV-FORMAT</a>)</li>
<li><input disabled="" type="checkbox"/>
Manually check automatic fixes  (<a href="02_devenv.html#DENV-AUTOFIX">DENV-AUTOFIX</a>)</li>
</ul>
</li>
<li>
<p>Libraries:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Check for outdated dependencies versions (cargo-outdated) (<a href="03_libraries.html#LIBS-OUTDATED">LIBS-OUTDATED</a>)</li>
<li><input disabled="" type="checkbox"/>
Check for security vulnerabilities report on dependencies (cargo-audit) (<a href="03_libraries.html#LIBS-AUDIT">LIBS-AUDIT</a>)</li>
<li><input disabled="" type="checkbox"/>
Check for unsafe code in dependencies (<a href="03_libraries.html#LIBS-UNSAFE">LIBS-UNSAFE</a>)</li>
</ul>
</li>
<li>
<p>The language:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Respect naming conventions (<a href="04_language.html#LANG-NAMING">LANG-NAMING</a>)</li>
<li><input disabled="" type="checkbox"/>
Do not use uninitialized memory  (<a href="04_language.html#MEM-UNINIT">MEM-UNINIT</a>)</li>
<li><input disabled="" type="checkbox"/>
Zero out memory of sensitive data after use (<a href="04_language.html#MEM-ZERO">MEM-ZERO</a>)</li>
<li><input disabled="" type="checkbox"/>
Don't use unsafe blocks (<a href="04_language.html#LANG-UNSAFE">LANG-UNSAFE</a>)</li>
<li><input disabled="" type="checkbox"/>
Use appropriate arithmetic operations regarding potential overflows (<a href="04_language.html#LANG-ARITH">LANG-ARITH</a>)</li>
<li><input disabled="" type="checkbox"/>
Implement custom <code>Error</code> type, wrapping all possible errors (<a href="04_language.html#LANG-ERRWRAP">LANG-ERRWRAP</a>)</li>
<li><input disabled="" type="checkbox"/>
Use the <code>?</code> operator and do not use the <code>try!</code> macro (<a href="04_language.html#LANG-ERRDO">LANG-ERRDO</a>)</li>
<li><input disabled="" type="checkbox"/>
Don't use functions that can cause <code>panic!</code> (<a href="04_language.html#LANG-NOPANIC">LANG-NOPANIC</a>)</li>
<li><input disabled="" type="checkbox"/>
Test properly array indexing or use the <code>get</code> method (<a href="04_language.html#LANG-ARRINDEXING">LANG-ARRINDEXING</a>)</li>
<li><input disabled="" type="checkbox"/>
Handle correctly <code>panic!</code> in FFI (<a href="04_language.html#LANG-FFIPANIC">LANG-FFIPANIC</a>)</li>
<li><input disabled="" type="checkbox"/>
Justify <code>Drop</code> implementation (<a href="04_language.html#LANG-DROP">LANG-DROP</a>)</li>
<li><input disabled="" type="checkbox"/>
Do not panic in <code>Drop</code> implementation (<a href="04_language.html#LANG-DROP-NO-PANIC">LANG-DROP-NO-PANIC</a>)</li>
<li><input disabled="" type="checkbox"/>
Do not allow cycles of reference-counted <code>Drop</code> (<a href="04_language.html#LANG-DROP-NO-CYCLE">LANG-DROP-NO-CYCLE</a>)</li>
<li><input disabled="" type="checkbox"/>
Do not rely only on <code>Drop</code> to ensure security (<a href="04_language.html#LANG-DROP-SEC">LANG-DROP-SEC</a>)</li>
<li><input disabled="" type="checkbox"/>
Justify <code>Send</code> and <code>Sync</code> implementation (<a href="04_language.html#LANG-SYNC-TRAITS">LANG-SYNC-TRAITS</a>)</li>
<li><input disabled="" type="checkbox"/>
Respect the invariants of standard comparison traits (<a href="04_language.html#LANG-CMP-INV">LANG-CMP-INV</a>)</li>
<li><input disabled="" type="checkbox"/>
Use the default method implementation of standard comparison traits (<a href="04_language.html#LANG-CMP-DEFAULTS">LANG-CMP-DEFAULTS</a>)</li>
<li><input disabled="" type="checkbox"/>
Derive comparison traits when possible (<a href="04_language.html#LANG-CMP-DERIVE">LANG-CMP-DERIVE</a>)</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
